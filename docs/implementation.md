---
test-type: doctest
---

# Groktest Implementation

The tests in this section demonstrate internal Groktest behavior. These
may be considered unit tests.

    >>> import groktest



## Comparing test output to expected

The Groktest function `match_test_output()` is used to compare test
output (a string generated by evaluating a test expression) to the
expected output.

    >>> from groktest import match_test_output

Create a function that prints bound variables for a match.

    >>> def match(expected, test_output, types=None, case_sensitive=False):
    ...     m = match_test_output(expected, test_output, types, case_sensitive)
    ...     if m:
    ...         pprint(m.bound_variables)
    ...     else:
    ...         print("<no match>")

Match simple output.

    >>> match("1", "1")
    {}

Use format expressions.

    >>> match("{}", "1")
    {}

    >>> match("{:d}", "1")
    {}

    >>> match("{:D}", "1")
    <no match>

    >>> match("A {} cat", "A blue cat")
    {}

    >>> match("A {} cat", "A red cat")
    {}

    >>> match("A {} cat", "A red dog")
    <no match>

    >>> match("A {} cat", "A blue and red cat")
    {}

    >>> match("A {:w} cat", "A blue and red cat")
    <no match>

Use variables.

    >>> match("{x:d}", "1")
    {'x': 1}

    >>> match("A {desc} cat", "A blue cat")
    {'desc': 'blue'}

    >>> match("A {desc} cat", "A blue and red cat")
    {'desc': 'blue and red'}

Groktest match support can be customized with custom match types.

    >>> match(
    ...     "A {:color} cat",
    ...     "A blue cat",
    ...     {"color": "blue|red"}
    ... )
    {}

    >>> match(
    ...     "A {color:color} cat",
    ...     "A red cat",
    ...     {"color": "blue|red"}
    ... )
    {'color': 'red'}

    >>> match(
    ...     "A {:color} cat",
    ...     "A green cat",
    ...     {"color": "blue|red"}
    ... )
    <no match>

By default matches are case-insensitive.

    >>> match("Hello", "hello")
    {}

Compare with case sensitive.

    >>> match("Hello", "hello", case_sensitive=True)
    <no match>

Match types can specify a case-insensitive pattern using `(?i)`.

    >>> match(
    ...     "A {color:color} cat",
    ...     "A RED cat",
    ...     {"color": "(?i)blue|red"},
    ...     case_sensitive=True
    ... )
    {'color': 'RED'}

    >>> match(
    ...     "A {color:color} cat",
    ...     "A bluE cat",
    ...     {"color": "(?i)blue|red"},
    ...     case_sensitive=True
    ... )
    {'color': 'bluE'}

Patterns match across multipe lines.

    >>> match(
    ... """
    ... Traceback (most recent call last):
    ... {stack}
    ... ZeroDivisionError: division by zero
    ... """,
    ... """
    ... Traceback (most recent call last):
    ... File "<stdin>", line 1, in <module>
    ... File "<stdin>", line 2, in boom
    ... ZeroDivisionError: division by zero
    ... """
    ... )
    {'stack': 'File "<stdin>", line 1, in <module>\n'
              'File "<stdin>", line 2, in boom'}

Non-patterns are sensitive to line-endings.

    >>> match("a b", "a\nb")
    <no match>

    >>> match("a b", "\na b\n")
    <no match>

To match the previous example, the leading and trailing line-endings
need to be stripped.

    >>> match("a b", "\na b\n".strip())
    {}

## Runner state

TODO

Runner state an internal construct Groktest uses when running tests.

    >> state = groktest.init_runner_state("examples/doctest.md")

Groktest loads the specified file and initializes runner state.

TODO

### Errors

A file must exist.

    >>> groktest.init_runner_state("does_not_exist")
    Traceback (most recent call last):
    FileNotFoundError: [Errno 2] No such file or directory: 'does_not_exist'
